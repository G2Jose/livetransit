SlidingMarker.initializeGlobally();m=100;b=10;var cityCircle;var options={radius:10,strokeOpacity:1,strokeWeight:0.5,fillOpacity:1,strokeColor:"#FFFFFF"};var polygonOptions={icon:{path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,scale:1.5,fillColor:"#000080",strokeColor:"#000080",fillOpacity:1,strokeOpacity:1,},duration:5000,draggable:false,title:"ABC"};var infoWindow=new google.maps.InfoWindow();function toRad(a){return parseFloat(a)*Math.PI/180}function x1(a){return Math.sin(a*Math.PI/180)*Math.pow((Math.pow(m,2)-Math.pow(b,2)),1/2)}function y1(a){return Math.cos(a*Math.PI/180)*Math.pow((Math.pow(m,2)-Math.pow(b,2)),1/2)}function x2(a){return Math.cos(-1*a*Math.PI/180)*b}function y2(a){return b*Math.sin(-1*a*Math.PI/180)}function x3(a){return -1*Math.cos(-1*a*Math.PI/180)*b}function y3(a){return -1*b*Math.sin(-1*a*Math.PI/180)}var polygons={};var vehicles={};var ages=[];var circles={};var itemsChanged=0;var opacity=0;function initialize(){var c={zoom:15,center:new google.maps.LatLng(43.64467,-79.39959),};var d=new google.maps.Map(document.getElementById("map-canvas"),c);options.map=d;polygonOptions.map=d;function a(){$.ajax({type:"GET",url:"http://restbus.info/api/agencies/ttc/vehicles",success:function(g){itemsChanged=0;var l=g.length;for(var h=0;h<l;h++){var n=g[h]["id"];var k=new google.maps.LatLng(parseFloat(g[h]["lat"]),parseFloat(g[h]["lon"]));var f=g[h]["secsSinceReport"];var j=g[h]["heading"];var e="#008900";polygonOptions.title=g[h]["routeId"];polygonOptions.icon.rotation=parseFloat(j);opacity=(100-5/3*f)/100;if(!(n in vehicles)){vehicles[n]={xy:k,age:f};polygonOptions.position=k;polygonOptions.icon.fillOpacity=opacity;polygonOptions.icon.strokeOpacity=opacity;polygons[n]=new SlidingMarker(polygonOptions)}else{if(vehicles[n]["xy"].lat()!=k.lat()){itemsChanged+=1;vehicles[n]["xy"]=k;polygonOptions.position=k;polygonOptions.icon.fillOpacity=opacity;polygonOptions.icon.strokeOpacity=opacity;polygons[n].setOpacity(opacity);polygons[n].setIcon(polygonOptions.icon);polygons[n].setPosition(k)}else{polygons[n].setOpacity(opacity)}}}}})}setInterval(a,3000)}google.maps.event.addDomListener(window,"load",initialize);