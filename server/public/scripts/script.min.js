m=100;b=10;var cityCircle;var options={radius:10,strokeOpacity:1,strokeWeight:0.01,fillOpacity:1,strokeColor:"#FFFFFF"};var infoWindow=new google.maps.InfoWindow();function toRad(a){return parseFloat(a)*Math.PI/180}function x1(a){return Math.sin(a*Math.PI/180)*Math.pow((Math.pow(m,2)-Math.pow(b,2)),1/2)}function y1(a){return Math.cos(a*Math.PI/180)*Math.pow((Math.pow(m,2)-Math.pow(b,2)),1/2)}function x2(a){return Math.cos(-1*a*Math.PI/180)*b}function y2(a){return b*Math.sin(-1*a*Math.PI/180)}function x3(a){return -1*Math.cos(-1*a*Math.PI/180)*b}function y3(a){return -1*b*Math.sin(-1*a*Math.PI/180)}var vehicles={};var ages=[];var allCircles=[];var circlesToRemove=[];var circles={};var itemsChanged=0;function initialize(){var c={zoom:15,center:new google.maps.LatLng(43.64467,-79.39959),};var d=new google.maps.Map(document.getElementById("map-canvas"),c);options.map=d;function a(){$.ajax({type:"GET",url:"http://restbus.info/api/agencies/ttc/vehicles",success:function(g){console.log("recieved response");itemsChanged=0;var k=g.length;for(var h=0;h<k;h++){var l=g[h]["id"];var j=new google.maps.LatLng(parseFloat(g[h]["lat"]),parseFloat(g[h]["lon"]));var f=g[h]["secsSinceReport"];var e="#000000";if(f>=30){e="#CC0000"}else{if(f>=15){e="#000000"}else{e="#008900"}}if(!(l in vehicles)){vehicles[l]={xy:j,age:f};options.center=j;options.fillColor=e;circles[l]=new google.maps.Circle(options)}else{if(vehicles[l]["xy"].lat()!=j.lat()){circles[l].setMap(null);itemsChanged+=1;vehicles[l]["xy"]=j;options.center=j;options.fillColor=e;circles[l]=new google.maps.Circle(options)}else{circles[l].setOptions({fillColor:e})}}}}})}setInterval(a,5000)}google.maps.event.addDomListener(window,"load",initialize);